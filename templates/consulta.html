{% extends "base.html" %}

{% block title %}Consulta de Alunos{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center mb-4">
        <div class="col-lg-8 text-center">
            <h1 class="fw-bold text-primary mb-2"><i class="bi bi-search me-2"></i>Consulta de Alunos</h1>
            <p class="text-muted">Pesquise por nome, código ou turma</p>
        </div>
    </div>

    <div class="row justify-content-center mb-5">
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-2">
                    <form method="POST" class="d-flex gap-2">
                        <input type="text" name="termo" class="form-control form-control-lg border-0 bg-light"
                            placeholder="Digite sua busca..." value="{{ termo }}" autofocus>
                        <button type="submit" class="btn btn-primary px-4 fw-bold">
                            <i class="bi bi-search"></i>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    {% if mensagem %}
    <div class="row justify-content-center mb-4">
        <div class="col-lg-8">
            <div class="alert {% if alerta or erro %}alert-danger{% else %}alert-success{% endif %} d-flex align-items-center shadow-sm"
                role="alert">
                <i
                    class="bi {% if alerta or erro %}bi-exclamation-triangle-fill{% else %}bi-check-circle-fill{% endif %} fs-4 me-3"></i>
                <div class="flex-grow-1">
                    {{ mensagem }}
                </div>
                <button class="btn btn-sm btn-outline-dark ms-3" onclick="window.history.back()">Voltar</button>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="row justify-content-center">
        <div class="col-lg-8">
            {% for aluno in resultados %}
            <div class="card border-0 shadow-sm mb-3 overflow-hidden">
                <div class="card-body p-0">
                    <div class="d-flex flex-column flex-md-row">
                        <!-- Photo Section -->
                        <div class="bg-light p-3 d-flex align-items-center justify-content-center"
                            style="min-width: 120px;">
                            <img src="{{ url_for('static', filename='fotos/' ~ aluno['Foto']) }}" alt="Foto"
                                class="rounded-circle shadow-sm border border-3 border-white"
                                style="width: 80px; height: 80px; object-fit: cover;">
                        </div>

                        <!-- Info Section -->
                        <div class="p-3 flex-grow-1 d-flex flex-column justify-content-center">
                            <h4 class="fw-bold text-dark mb-1">{{ aluno['Nome'] }}</h4>
                            <div class="d-flex flex-wrap gap-2">
                                <span
                                    class="badge bg-primary-subtle text-primary-emphasis border border-primary-subtle">
                                    <i class="bi bi-people-fill me-1"></i>{{ aluno['Turma'] }}
                                </span>
                                <span
                                    class="badge bg-secondary-subtle text-secondary-emphasis border border-secondary-subtle">
                                    <i class="bi bi-upc me-1"></i>{{ aluno['Codigo'] }}
                                </span>
                            </div>
                        </div>

                        <!-- Actions Section -->
                        <div class="p-3 bg-white border-start-md d-flex flex-column justify-content-center gap-2"
                            style="min-width: 200px;">
                            <a href="{{ url_for('registros_files', filename=aluno['Turma'] ~ '/' ~ aluno['Codigo'] ~ '.txt') }}"
                                class="btn btn-outline-primary btn-sm text-start">
                                <i class="bi bi-file-text me-2"></i>Ver Registro
                            </a>
                            <a href="{{ url_for('ocorrencias_aluno', codigo=aluno['Codigo']) }}"
                                class="btn btn-outline-warning btn-sm text-start text-dark">
                                <i class="bi bi-exclamation-circle me-2"></i>Ocorrências
                            </a>
                            <form method="POST" class="d-grid">
                                <input type="hidden" name="registrar_codigo" value="{{ aluno['Codigo'] }}">
                                <button type="submit" class="btn btn-success btn-sm text-start fw-bold">
                                    <i class="bi bi-check-lg me-2"></i>Registrar Acesso
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}