{% extends "base.html" %}

{% block title %}Consulta{% endblock %}

{% block content %}
<div class="container-fluid py-3" style="max-width:900px; width:100%; margin:auto;">
    <div class="text-center mb-4">
        <h1 class="fw-bold" style="color: #14532d; letter-spacing: 1px;">Consulta de Alunos</h1>
        <p class="text-muted">Pesquise por nome, código ou turma para encontrar um aluno.</p>
    </div>
    <form method="POST" class="d-flex flex-row align-items-center gap-2 p-2 rounded-4 shadow-sm bg-white mb-4" style="min-height:unset;">
        <input type="text" name="termo" placeholder="Digite o nome, código ou turma" value="{{ termo }}" class="form-control form-control-lg border-2" style="font-size:1.1em;">
        <button type="submit" class="btn btn-success btn-lg px-4 shadow-sm" style="letter-spacing:1px;">Pesquisar</button>
    </form>

    {% if mensagem %}
    <div class="mensagem {% if alerta or erro %}erro{% else %}sucesso{% endif %} text-center" style="font-size:1.1em;">
        {{ mensagem }}
        <button class="btn btn-outline-secondary btn-sm mt-2" onclick="window.history.back()">Voltar</button>
    </div>
    {% endif %}

    <div class="resultados-consulta-lista">
        {% for aluno in resultados %}
    <div class="card mb-3 shadow-sm rounded-4" style="max-width:700px; margin:auto;">
            <div class="card-body d-flex flex-row align-items-center gap-3">
                <img src="{{ url_for('static', filename='fotos/' ~ aluno['Foto']) }}" alt="Foto do Aluno" class="foto-consulta shadow" style="width:80px; height:80px; object-fit:cover; border-radius:50%; border:3px solid #22ce6a; background:#f6f6f6;">
                <div class="flex-grow-1">
                    <h4 class="fw-bold mb-1" style="color:#14532d; word-break:break-word;">{{ aluno['Nome'] }}</h4>
                    <span class="badge bg-light text-dark px-2 py-1 shadow-sm me-2">Turma: <strong>{{ aluno['Turma'] }}</strong></span>
                    <span class="badge bg-light text-dark px-2 py-1 shadow-sm">Código: <strong>{{ aluno['Codigo'] }}</strong></span>
                </div>
                <div class="d-flex flex-column gap-2 botao-mobile-group" style="min-width:180px;">
                    <a href="{{ url_for('registros_files', filename=aluno['Turma'] ~ '/' ~ aluno['Codigo'] ~ '.txt') }}" class="btn btn-success rounded-4 fw-bold px-3 py-2 w-100" style="font-size:1em;">Ver Registro</a>
                    <a href="{{ url_for('ocorrencias_aluno', codigo=aluno['Codigo']) }}" class="btn btn-warning rounded-4 fw-bold px-3 py-2 text-dark w-100" style="font-size:1em;">Ver Ocorrências</a>
                    <form method="POST" class="w-100">
                        <input type="hidden" name="registrar_codigo" value="{{ aluno['Codigo'] }}">
                        <button type="submit" class="btn btn-primary rounded-4 fw-bold px-3 py-2 w-100" style="font-size:1em;">Registrar Acesso</button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
<style>
@media (max-width: 700px) {
    .botao-mobile-group {
        min-width: 0 !important;
        width: 100% !important;
    }
    .botao-mobile-group .btn, .botao-mobile-group form {
        width: 100% !important;
        min-width: 0 !important;
        display: block !important;
    }
    .botao-mobile-group .btn {
        font-size: 1em !important;
        padding-left: 0.5em !important;
        padding-right: 0.5em !important;
        margin-bottom: 8px !important;
    }
    .botao-mobile-group form {
        margin-bottom: 8px !important;
    }
}
</style>
{% endblock %}