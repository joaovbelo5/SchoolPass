{% extends 'base.html' %}

{% block title %}Gerenciar Cadastros{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Header Section -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-4 gap-3">
        <div class="text-center text-md-start">
            <h1 class="fw-bold text-primary mb-1">
                <i class="bi bi-people-fill me-2"></i>Gerenciar Alunos
            </h1>
            <p class="text-secondary mb-0 fw-medium">Consulte, edite ou adicione novos alunos</p>
        </div>
        <a href="{{ url_for('novo') }}" class="btn btn-success btn-lg fw-bold px-4 d-flex align-items-center gap-2">
            <i class="bi bi-plus-lg fs-5"></i>
            <span>Novo Aluno</span>
        </a>
    </div>

    <!-- Search Section -->
    <div class="card mb-4 overflow-hidden">
        <div class="card-body p-3">
            <form method="GET" action="{{ url_for('pesquisar') }}" class="d-flex gap-2">
                <div class="position-relative flex-grow-1">
                    <i
                        class="bi bi-search position-absolute top-50 start-0 translate-middle-y ms-3 text-secondary fs-5"></i>
                    <input type="text" name="query" class="form-control form-control-lg ps-5"
                        placeholder="Pesquisar por nome, turma ou cÃ³digo..." required>
                </div>
                <button type="submit" class="btn btn-primary px-4 fw-bold d-none d-md-block">
                    Pesquisar
                </button>
                <button type="submit" class="btn btn-primary px-3 fw-bold d-md-none">
                    <i class="bi bi-search"></i>
                </button>
            </form>
        </div>
    </div>

    <!-- Students Grid List -->
    <div class="row g-3">
        {% for aluno in alunos %}
        <div class="col-12">
            <div class="card">
                <div class="card-body p-3">
                    <div class="row align-items-center gy-3">

                        <!-- Col 1: Photo & ID (Mobile: Top) -->
                        <div class="col-auto">
                            <div class="position-relative">
                                <img src="{{ url_for('static', filename='fotos/' + aluno.Foto) }}"
                                    alt="{{ aluno.Nome }}" class="rounded-circle object-fit-cover border"
                                    style="width: 72px; height: 72px;"
                                    onerror="this.src='{{ url_for('static', filename='fotos/semfoto.jpg') }}'">
                                <span
                                    class="position-absolute bottom-0 start-50 translate-middle-x badge bg-dark border border-white"
                                    style="font-size: 0.7rem;">
                                    {{ aluno.Codigo }}
                                </span>
                            </div>
                        </div>

                        <!-- Col 2: Info (Name, Class, Status) -->
                        <div class="col text-center text-md-start">
                            <h5 class="fw-bold text-dark mb-1 text-break">{{ aluno.Nome }}</h5>

                            <div class="d-flex flex-wrap justify-content-center justify-content-md-start gap-2 mb-2">
                                <span class="badge bg-light text-secondary border border-secondary-subtle">
                                    <i class="bi bi-people-fill me-1"></i>{{ aluno.Turma }}
                                </span>
                                <span class="badge bg-light text-secondary border border-secondary-subtle">
                                    <i class="bi bi-clock-fill me-1"></i>{{ aluno.Turno }}
                                </span>
                            </div>

                            <div>
                                {% if aluno.Permissao == 'Sim' %}
                                <span class="badge bg-success-subtle text-success border border-success-subtle">
                                    <i class="bi bi-check-circle-fill me-1"></i>Permitido
                                </span>
                                {% else %}
                                <span class="badge bg-danger-subtle text-danger border border-danger-subtle">
                                    <i class="bi bi-x-circle-fill me-1"></i>Negado
                                </span>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Col 3: Actions (Desktop: Right, Mobile: Bottom Full Width) -->
                        <div class="col-12 col-md-auto">
                            <div class="d-flex gap-2 justify-content-center">
                                <a href="{{ url_for('editar', codigo=aluno.Codigo) }}"
                                    class="btn btn-light text-primary border d-flex align-items-center justify-content-center"
                                    style="width: 42px; height: 42px;" title="Editar">
                                    <i class="bi bi-pencil-fill fs-5"></i>
                                </a>

                                <form method="POST" action="{{ url_for('emitir') }}" class="d-inline">
                                    <input type="hidden" name="tipo_emissao" value="unitaria">
                                    <input type="hidden" name="codigo" value="{{ aluno.Codigo }}">
                                    <button type="submit"
                                        class="btn btn-light text-success border d-flex align-items-center justify-content-center"
                                        style="width: 42px; height: 42px;" title="Emitir Carteirinha">
                                        <i class="bi bi-printer-fill fs-5"></i>
                                    </button>
                                </form>

                                <a href="{{ url_for('excluir', codigo=aluno.Codigo) }}"
                                    class="btn btn-light text-danger border d-flex align-items-center justify-content-center"
                                    style="width: 42px; height: 42px;" title="Excluir"
                                    onclick="return confirm('Tem certeza que deseja excluir o aluno {{ aluno.Nome }}?');">
                                    <i class="bi bi-trash-fill fs-5"></i>
                                </a>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="col-12 text-center py-5">
            <div class="text-muted opacity-50 mb-3">
                <i class="bi bi-inbox-fill" style="font-size: 4rem;"></i>
            </div>
            <h4 class="fw-bold text-secondary">Nenhum aluno encontrado</h4>
            <p class="text-muted">Tente buscar por outro termo ou adicione um novo aluno.</p>
        </div>
        {% endfor %}
    </div>
</div>

<style>
    .object-fit-cover {
        object-fit: cover;
    }
</style>
{% endblock %}