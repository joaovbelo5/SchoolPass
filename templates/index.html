{% extends "base.html" %}
{% block content %}
<div class="container-fluid py-2" style="max-width:600px; width:100%; margin:auto;">
    <form method="POST" class="p-2 rounded-4 shadow-sm bg-white d-flex flex-row align-items-center gap-2 mb-2" style="min-height:unset;">
        <input type="text" name="codigo" class="form-control form-control-sm border-2" placeholder="Digite ou escaneie o c처digo da carteirinha" autofocus required style="font-size:0.95em; min-width:0;">
        <button type="submit" class="btn btn-success btn-sm px-3 shadow-sm" style="letter-spacing:0.5px; min-width:80px;">Registrar</button>
    </form>

    {% if mensagem %}
    <div class="mensagem {% if 'Negado' in mensagem or 'n찾o encontrado' in mensagem %}erro{% else %}sucesso{% endif %} text-center" style="font-size:0.75em;">
        {{ mensagem }}
    </div>
    {% endif %}

    {% if aluno %}
    <div class="d-flex flex-column flex-md-row align-items-center gap-3 p-3 rounded-4 shadow bg-white my-2">
        <div class="d-flex justify-content-center align-items-center" style="min-width:160px;">
            <img src="{{ url_for('static', filename='fotos/' + aluno.Foto) }}" alt="Foto do Aluno" class="shadow" style="width: 140px; height: 140px; object-fit: cover; border-radius: 50%; border: 4px solid #22ce6a; background: #f6f6f6;">
        </div>
        <div class="flex-grow-1 text-center text-md-start">
            <h2 class="fw-bold mb-1" style="color: #14532d; font-size:2em; word-break: break-word;">{{ aluno.Nome }}</h2>
            <div class="mb-1"><span class="badge bg-light text-dark px-2 py-1 shadow-sm">Turma: <strong>{{ aluno.Turma }}</strong></span></div>
            <div class="mb-1"><span class="badge bg-light text-dark px-2 py-1 shadow-sm">Turno: <strong>{{ aluno.Turno }}</strong></span></div>
            <div class="mb-1">
                <span class="badge px-2 py-1 shadow-sm {% if aluno.Permissao == 'Sim' %}bg-success{% else %}bg-danger{% endif %}" style="font-size:1.1em;">
                    {{ 'PERMITIDO' if aluno.Permissao == 'Sim' else 'PROIBIDO' }}
                </span>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="counter-container mt-2 mb-2 p-2 rounded-4 shadow-sm bg-white d-flex gap-2">
        <div class="counter-item flex-fill">
            <h5 class="text-success mb-1" style="font-size:0.95em;">Manh찾</h5>
            <h3 id="contador-manha" class="fw-bold" style="font-size:1.2em;">0</h3>
        </div>
        <div class="counter-item flex-fill">
            <h5 class="text-success mb-1" style="font-size:0.95em;">Tarde</h5>
            <h3 id="contador-tarde" class="fw-bold" style="font-size:1.2em;">0</h3>
        </div>
        <div class="counter-item flex-fill">
            <h5 class="text-success mb-1" style="font-size:0.95em;">Noite</h5>
            <h3 id="contador-noite" class="fw-bold" style="font-size:1.2em;">0</h3>
        </div>
        <div class="counter-item total flex-fill">
            <h5 class="text-success mb-1" style="font-size:0.95em;">Total</h5>
            <h3 id="contador-total" class="fw-bold" style="font-size:1.2em;">0</h3>
        </div>
    </div>
</div>



<script>
function atualizarContadores() {
    fetch('/get_contadores')
        .then(response => response.json())
        .then(data => {
            document.getElementById('contador-manha').textContent = data.contadores['Manh찾'] || 0;
            document.getElementById('contador-tarde').textContent = data.contadores['Tarde'] || 0;
            document.getElementById('contador-noite').textContent = data.contadores['Noite'] || 0;
            document.getElementById('contador-total').textContent = data.total || 0;
        });
}
setInterval(atualizarContadores, 1000);
atualizarContadores();
</script>

{% if alerta %}
<audio autoplay>
    <source src="{{ url_for('static', filename='alert.mp3') }}" type="audio/mpeg">
</audio>
{% endif %}
{% endblock %}