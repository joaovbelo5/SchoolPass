{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8 col-xl-7">
        <div class="card shadow-sm border-0 mb-4">
            <div class="card-body">
                <form method="POST" class="row g-2 align-items-center">
                    <div class="col-12 col-md-9">
                        <input type="text" name="codigo" class="form-control form-control-lg" placeholder="Digite ou escaneie o c처digo da carteirinha" autofocus required>
                    </div>
                    <div class="col-12 col-md-3 d-grid">
                        <button type="submit" class="btn btn-success btn-lg">Registrar</button>
                    </div>
                </form>
                {% if mensagem %}
                    <div class="mt-3">
                        <div class="alert {% if 'Negado' in mensagem or 'n찾o encontrado' in mensagem %}alert-danger{% else %}alert-success{% endif %} text-center">
                            {{ mensagem }}
                        </div>
                    </div>
                {% endif %}
                {% if aluno %}
                <div class="row align-items-center mt-4 g-3 flex-md-row flex-column">
                    <div class="col-12 col-md-4 text-center mb-3 mb-md-0 d-flex justify-content-center align-items-center" style="min-height: 230px;">
                        <div style="width:220px; height:220px; display:flex; align-items:center; justify-content:center;">
                            <img src="{{ url_for('static', filename='fotos/' + aluno.Foto) }}" alt="Foto do Aluno" class="img-fluid rounded shadow" style="width: 220px; height: 220px; object-fit: cover;">
                        </div>
                    </div>
                    <div class="col-12 col-md-8 d-flex flex-column justify-content-center" style="min-height: 120px;">
                        <h2 class="mb-3 mt-2 mt-md-0" style="color: #14532d; word-break: break-word;">{{ aluno.Nome }}</h2>
                        <p class="mb-1"><strong>Turma:</strong> {{ aluno.Turma }}</p>
                        <p class="mb-1"><strong>Turno:</strong> {{ aluno.Turno }}</p>
                        <p class="mb-1"><strong>Status:</strong>
                            <span class="badge {% if aluno.Permissao == 'Sim' %}bg-success{% else %}bg-danger{% endif %}">
                                {{ 'PERMITIDO' if aluno.Permissao == 'Sim' else 'PROIBIDO' }}
                            </span>
                        </p>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="row justify-content-center mb-4">
    <div class="col-lg-8 col-xl-7">
        <div class="card border-success shadow-sm">
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-6 col-md-3 mb-2">
                        <div class="fw-bold text-success">Manh찾</div>
                        <div id="contador-manha" class="fs-4">0</div>
                    </div>
                    <div class="col-6 col-md-3 mb-2">
                        <div class="fw-bold text-success">Tarde</div>
                        <div id="contador-tarde" class="fs-4">0</div>
                    </div>
                    <div class="col-6 col-md-3 mb-2">
                        <div class="fw-bold text-success">Noite</div>
                        <div id="contador-noite" class="fs-4">0</div>
                    </div>
                    <div class="col-6 col-md-3 mb-2">
                        <div class="fw-bold text-success">Total</div>
                        <div id="contador-total" class="fs-4">0</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function atualizarContadores() {
        fetch('/get_contadores')
                .then(response => response.json())
                .then(data => {
                        document.getElementById('contador-manha').textContent = data.contadores['Manh찾'] || 0;
                        document.getElementById('contador-tarde').textContent = data.contadores['Tarde'] || 0;
                        document.getElementById('contador-noite').textContent = data.contadores['Noite'] || 0;
                        document.getElementById('contador-total').textContent = data.total || 0;
                });
}
setInterval(atualizarContadores, 1000);
atualizarContadores();
</script>

{% if alerta %}
<audio autoplay>
        <source src="{{ url_for('static', filename='alert.mp3') }}" type="audio/mpeg">
</audio>
{% endif %}
{% endblock %}