{% extends "base.html" %}
{% block content %}
<div class="d-flex flex-column align-items-center" style="max-width: 800px; margin: 0 auto; margin-top: 24px;">
    <div class="card shadow-sm border-0 w-100" style="max-width: 500px;">
        <div class="card-body p-2">
            <form method="POST" class="d-flex flex-row gap-2 align-items-center mb-0" style="width:100%;">
                <input type="text" name="codigo" class="form-control text-center" placeholder="Digite ou escaneie o c처digo" autofocus required style="font-size:0.7em; width:140px; min-width:0;">
                <button type="submit" class="btn btn-success px-3" style="font-size:1.1em; height:40px; min-width:140px;">Registrar</button>
            </form>
            {% if mensagem %}
                <div class="mt-1">
                    <div class="alert {% if 'Negado' in mensagem or 'n찾o encontrado' in mensagem %}alert-danger{% else %}alert-success{% endif %} text-center p-1" style="font-size:0.95em;">
                        {{ mensagem }}
                    </div>
                </div>
            {% endif %}
            {% if aluno %}
            <div class="d-flex flex-row align-items-center mt-3 gap-3" style="min-height: 120px;">
                <div class="text-center">
                    <img src="{{ url_for('static', filename='fotos/' + aluno.Foto) }}" alt="Foto do Aluno" class="rounded shadow" style="width: 240px; height: 240px; object-fit: cover;">
                </div>
                <div class="d-flex flex-column justify-content-center" style="min-width: 0;">
                    <div class="mb-0" style="color: #14532d; word-break: break-word; font-size:2em; font-weight:700; line-height:1.1;">{{ aluno.Nome }}</div>
                    <div style="font-size:1.2em;">
                        <span><strong>Turma:</strong> {{ aluno.Turma }}</span> |
                        <span><strong>Turno:</strong> {{ aluno.Turno }}</span><br>
                        <span><strong>Status:</strong>
                            <span class="badge {% if aluno.Permissao == 'Sim' %}bg-success{% else %}bg-danger{% endif %}" style="font-size:1.1em;">
                                {{ 'PERMITIDO' if aluno.Permissao == 'Sim' else 'PROIBIDO' }}
                            </span>
                        </span>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    <div class="card border-success shadow-sm w-100" style="max-width: 500px;">
        <div class="card-body p-1">
            <div class="row text-center g-1">
                <div class="col-3">
                    <div class="fw-bold text-success" style="font-size:0.85em;">Manh찾</div>
                    <div id="contador-manha" class="fs-6">0</div>
                </div>
                <div class="col-3">
                    <div class="fw-bold text-success" style="font-size:0.85em;">Tarde</div>
                    <div id="contador-tarde" class="fs-6">0</div>
                </div>
                <div class="col-3">
                    <div class="fw-bold text-success" style="font-size:0.85em;">Noite</div>
                    <div id="contador-noite" class="fs-6">0</div>
                </div>
                <div class="col-3">
                    <div class="fw-bold text-success" style="font-size:0.85em;">Total</div>
                    <div id="contador-total" class="fs-6">0</div>
                </div>
            </div>
        </div>
    </div>
    {% if alerta %}
    <audio autoplay>
        <source src="{{ url_for('static', filename='alert.mp3') }}" type="audio/mpeg">
    </audio>
    {% endif %}
</div>
<script>
function atualizarContadores() {
    fetch('/get_contadores')
        .then(response => response.json())
        .then(data => {
            document.getElementById('contador-manha').textContent = data.contadores['Manh찾'] || 0;
            document.getElementById('contador-tarde').textContent = data.contadores['Tarde'] || 0;
            document.getElementById('contador-noite').textContent = data.contadores['Noite'] || 0;
            document.getElementById('contador-total').textContent = data.total || 0;
        });
}
setInterval(atualizarContadores, 1000);
atualizarContadores();
</script>
{% endblock %}