{% extends "base.html" %}

{% block title %}Histórico de Acessos{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center mb-4">
        <div class="col-lg-8 text-center">
            <h1 class="fw-bold text-primary mb-2"><i class="bi bi-clock-history me-2"></i>Histórico de Acessos</h1>
            <p class="text-muted">Visualize os registros de entrada e saída por data</p>
        </div>
    </div>

    <div class="row justify-content-center mb-5">
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-3">
                    <form method="POST" class="row g-3 align-items-end">
                        <div class="col-md-9">
                            <label for="data_selecionada" class="form-label fw-bold text-secondary">Selecione a
                                Data</label>
                            <input type="date" id="data_selecionada" name="data_selecionada"
                                class="form-control form-control-lg bg-light border-0"
                                value="{{ data_selecionada or '' }}" required>
                        </div>
                        <div class="col-md-3">
                            <button type="submit" class="btn btn-primary btn-lg w-100 fw-bold">
                                <i class="bi bi-search me-2"></i>Buscar
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    {% if registros %}
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="d-flex align-items-center justify-content-between mb-4">
                <h5 class="fw-bold text-primary mb-0">
                    <i class="bi bi-list-check me-2"></i>Registros Encontrados
                </h5>
                <span class="badge bg-primary rounded-pill px-3 py-2">{{ registros|length }}</span>
            </div>

            <div class="timeline">
                {% for registro in registros %}
                <div class="card border-0 shadow-sm mb-3 overflow-hidden">
                    <div class="card-body p-0">
                        <div class="d-flex flex-column flex-md-row">
                            <!-- Time & Status Strip -->
                            <div class="p-3 d-flex flex-column align-items-center justify-content-center text-white text-center"
                                style="min-width: 100px; background-color: {% if 'entrada' in registro.tipo_acesso.lower() or 'Acesso' in registro.tipo_acesso %}var(--bs-success){% else %}var(--bs-danger){% endif %};">
                                <div class="fs-4 fw-bold mb-1">{{ registro.data_hora.split(' ')[1] }}</div>
                                <div class="small text-uppercase opacity-75">{{ registro.tipo_acesso }}</div>
                            </div>

                            <!-- Photo -->
                            <div class="p-3 d-flex align-items-center justify-content-center bg-light border-end"
                                style="min-width: 100px;">
                                {% if registro.foto %}
                                <img src="/static/fotos/{{ registro.foto }}" alt="{{ registro.nome }}"
                                    class="rounded-circle shadow-sm border border-2 border-white"
                                    style="width: 64px; height: 64px; object-fit: cover;"
                                    onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'64\' height=\'64\' fill=\'%23ccc\' class=\'bi bi-person-circle\' viewBox=\'0 0 16 16\'%3E%3Cpath d=\'M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z\'/%3E%3Cpath fill-rule=\'evenodd\' d=\'M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z\'/%3E%3C/svg%3E'">
                                {% else %}
                                <div class="d-flex align-items-center justify-content-center bg-secondary bg-opacity-10 rounded-circle text-secondary"
                                    style="width: 64px; height: 64px;">
                                    <i class="bi bi-person-fill fs-3"></i>
                                </div>
                                {% endif %}
                            </div>

                            <!-- Info -->
                            <div class="p-3 flex-grow-1 d-flex flex-column justify-content-center">
                                <h5 class="fw-bold text-dark mb-2">{{ registro.nome }}</h5>
                                <div class="d-flex flex-wrap gap-2">
                                    <span class="badge bg-light text-dark border">
                                        <i class="bi bi-people-fill me-1 text-secondary"></i>{{ registro.turma }}
                                    </span>
                                    <span class="badge bg-light text-dark border">
                                        <i class="bi bi-upc me-1 text-secondary"></i>{{ registro.codigo }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    {% elif data_selecionada %}
    <div class="row justify-content-center">
        <div class="col-lg-6">
            <div class="alert alert-info d-flex align-items-center shadow-sm" role="alert">
                <i class="bi bi-info-circle-fill fs-4 me-3"></i>
                <div>
                    <strong>Nenhum registro encontrado</strong> para a data <strong>{{ data_selecionada }}</strong>.
                </div>
            </div>
        </div>
    </div>

    {% else %}
    <div class="row justify-content-center">
        <div class="col-lg-6">
            <div class="alert alert-warning d-flex align-items-center shadow-sm" role="alert">
                <i class="bi bi-calendar-event-fill fs-4 me-3"></i>
                <div>
                    <strong>Selecione uma data</strong> acima para visualizar o histórico.
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}