{% extends "base.html" %}

{% block title %}Lista de Chamada Mensal{% endblock %}

{% block content %}
<div class="container-fluid py-4" style="max-width:900px; width:100%; margin:auto;">
    <div class="text-center mb-4">
        <h2 class="fw-bold mb-1" style="color: #14532d; letter-spacing: 1px;">
            <i class="bi bi-calendar-check me-2"></i>Lista de Chamada Mensal
        </h2>
        <div class="text-muted" style="font-size:0.98em;">Consulte a frequência dos alunos por turma e mês</div>
    </div>
    <form method="POST" class="d-flex flex-row align-items-center gap-2 mb-4 bg-white p-2 rounded-4 shadow-sm justify-content-center" style="max-width:500px; margin:auto;">
        <label for="turma" class="form-label mb-0">Turma:</label>
        <select name="turma" id="turma" class="form-select form-select-sm shadow-none" style="max-width:180px; border-radius:8px;">
            {% for turma in turmas %}
                <option value="{{ turma }}" {% if turma_selecionada == turma %}selected{% endif %}>{{ turma }}</option>
            {% endfor %}
        </select>
        <label for="mes" class="form-label mb-0">Mês:</label>
        <input type="month" name="mes" id="mes" class="form-control form-control-sm shadow-none" style="max-width:180px; border-radius:8px;" value="{{ mes_selecionado.split('_') | reverse | join('-') if mes_selecionado else '' }}">
        <button type="submit" class="btn btn-success btn-sm px-3"><i class="bi bi-search me-1"></i>Ver</button>
    </form>
    {% if chamada_data %}
    <div class="table-responsive bg-white p-2 rounded-4 shadow-sm">
        <table class="table table-hover align-middle mb-0" style="border-radius:12px; overflow:hidden;">
            <thead style="background:#e9f5ee;">
                <tr>
                    <th class="text-nowrap">Código</th>
                    <th class="text-nowrap">Nome</th>
                    <th class="text-nowrap">Presenças</th>
                </tr>
            </thead>
            <tbody>
                {% for codigo, aluno in chamada_data.items() %}
                <tr>
                    <td>{{ codigo }}</td>
                    <td>{{ aluno.nome }}</td>
                    <td>{{ aluno.presencas|join(', ') }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% elif turma_selecionada %}
    <div class="alert alert-warning text-center mt-4">Nenhum registro encontrado para a turma e mês selecionados.</div>
    {% endif %}
</div>
<!-- Bootstrap Icons CDN -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.min.css">

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const monthInput = document.getElementById('mes');
        const form = monthInput.closest('form');

        form.addEventListener('submit', function(event) {
            const monthValue = monthInput.value; // Formato YYYY-MM
            if (monthValue) {
                const [year, month] = monthValue.split('-');
                const hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden';
                hiddenInput.name = 'mes';
                hiddenInput.value = `${month}_${year}`;
                form.appendChild(hiddenInput);
            }
        });
    });
</script>
{% endblock %}